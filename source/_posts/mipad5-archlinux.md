---
title: ğŸ¹ åœ¨å°ç±³å¹³æ¿ 5 ä¸Šå®‰è£… Arch Linux
date: 2024-06-22 21:09:50
tags:
- Linux
category: ArchæŠ˜è…¾è®°
cover: https://imgsrc.chyk.ink/a1ec08fa513d2697a5abcd6313fbb2fb4316d891.webp
references:
  - title: It's Linux, On Mi Pad 5. The fastest mainline tablet all the time.
    url: https://linux-on-nabu.gitbook.io/
  - title: map220v/ubuntu-xiaomi-nabu - GitHub
    url: https://github.com/map220v/ubuntu-xiaomi-nabu
---

å°ç±³å¹³æ¿ 5 æ˜¯ä¸€æ¬¾å‘å¸ƒäº 2021 å¹´çš„ä¼ å¥‡å®‰å“å¹³æ¿ï¼Œå®ƒä¸ä»…èƒ½å‡ ä¹å®Œç¾åœ°å®‰è£… Windows 11ï¼Œè¿˜å¯ä»¥å®‰è£… Arch Linux å¹¶æ»¡è¶³æ—¥ç”¨éœ€æ±‚ã€‚æœ¬æ–‡å°±æ¥ç®€è¿°å¦‚ä½•åœ¨å°ç±³å¹³æ¿ 5 ä¸Šå®‰è£… Arch Linuxï¼Œå¹¶é…ç½®åŒç³»ç»Ÿã€‚

<!--more-->

> æˆ‘ä»¬åŒå€¦äº†åœ¨è´­ä¹°æ–°å¹³æ¿ç”µè„‘åå¾ˆå¿«å°±æ— æ³•æ”¶åˆ°æ›´æ–°ã€‚åŒå€¦äº†æ·±åº¦é›†æˆåœ¨ Android å’Œ iOS ä¹‹ç±»çš„å°é—­ç³»ç»Ÿä¸­ï¼Œä»¥åŠè®¾å¤‡å‚å•†å‘å¸ƒçš„è€æ—§ã€è¿‡æ—¶çš„å†…æ ¸ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªå¯æŒç»­çš„ã€æ³¨é‡éšç§å’Œå®‰å…¨çš„è‡ªç”±è½¯ä»¶ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå®ƒåŸºäº Linux å‘è¡Œç‰ˆï¼Œä»¥æƒé™åˆ†ç¦»ä¸ºè®¾è®¡æ€è·¯ã€‚è®©æˆ‘ä»¬ä¿æŒå¹³æ¿ç”µè„‘çš„å®ç”¨æ€§å’Œå®‰å…¨æ€§ï¼Œç›´åˆ°å®ƒç‰©ç†æŸåä¸ºæ­¢ï¼
>
> â€”â€” Linux for Mi Pad 5

> 2024.11.29 æ›´æ–° â€”â€” ä½¿ç”¨æœ€æ–°æœ€çƒ­çš„ Linux 6.12 å†…æ ¸

### âš ï¸ è¯·æ³¨æ„

{% ablock color:red %}

åˆ·å…¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿéœ€è¦è§£é”å¹³æ¿çš„ bootloaderï¼Œè¿™ä¼šä½¿å¹³æ¿**å¤±å»ä¿ä¿®**å’Œä¸€éƒ¨åˆ†å”®åæ”¯æŒã€‚

{% endablock %}

{%ablock%}

æˆªæ­¢ 2024 å¹´ 11 æœˆï¼Œå°ç±³å¹³æ¿ 5 ä¸Šçš„ä¸»çº¿ Linux å†…æ ¸æ”¯æŒ**ä»ç„¶ä¸æ˜¯å¾ˆå®Œå–„**ï¼Œæ‰€ä»¥éƒ¨åˆ†ç¡¬ä»¶ï¼ˆå¦‚å–‡å­ã€ä¼ æ„Ÿå™¨ç­‰ï¼‰ä»ç„¶æ— æ³•æ­£å¸¸è¿ä½œã€‚è¯·å…ˆé˜…è¯»ä¸‹é¢çš„ã€Œç¡¬ä»¶æ”¯æŒã€ä¸€èŠ‚ã€‚

{%endablock%}

{%ablock%}

æœ¬æ–‡å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨ Arch Linux æ¡Œé¢ç³»ç»Ÿï¼Œå¹¶ä¸”å¯¹ Linux å’Œå®‰å“åˆ·æœºéƒ½æœ‰ä¸€å®šäº†è§£ã€‚

æœ¬æ–‡**ä»…ä¸ºæˆ‘ä¸ªäººæŠ˜è…¾ç»éªŒ**ï¼Œå¹¶éå°½å–„å°½ç¾çš„å®‰è£…æŒ‡å—ï¼Œä¼šæœ‰äº›å•°å”†ã€‚

{%endablock%}

{%ablock%}

åœ¨ ARM å¹³å°ä¸Šè¿è¡Œçš„ **Arch Linux ARM** ä¸ºç¤¾åŒºç”¨æˆ·æŠŠ Arch Linux ç§»æ¤åˆ° ARM ä¸Šçš„å‘è¡Œç‰ˆï¼Œå¹¶ä¸å— Arch Linux å®˜æ–¹å¼€å‘å›¢é˜Ÿæ”¯æŒã€‚å¹¶ä¸”ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå‘ç¤¾åŒºæé—®æ—¶ï¼Œä¸€å®šè¦æ³¨æ˜ä½¿ç”¨çš„æ˜¯ Arch Linux ARM è€Œé Arch Linuxã€‚

{%endablock%}

### ğŸ› ï¸ ç¡¬ä»¶æ”¯æŒ

æœ¬æ–‡å°†ä½¿ç”¨ï¼ˆæˆªæ­¢æ–‡ç« ç¼–å†™æ—¶ï¼‰æœ€æ–°æœ€çƒ­çš„ Linux 6.12 å†…æ ¸ã€‚è¯¥å†…æ ¸çš„ç¡¬ä»¶æ”¯æŒæœ€å¥½ï¼Œä½†ä»ç„¶æœ‰äº›ç¡¬ä»¶æ— æ³•æ­£å¸¸å·¥ä½œã€‚

- GPUï¼šä¸æ”¯æŒç¡¬ä»¶è§†é¢‘ç¼–è§£ç ã€‚

- æ‰¬å£°å™¨ï¼šåªæœ‰å·¦ä¸Šã€å·¦ä¸‹å’Œå³ä¸‹ä¸‰ä¸ªæ‰¬å£°å™¨å¯ä»¥æ­£å¸¸è¿ä½œï¼Œå³ä¸Šæ‰¬å£°å™¨ä¸èƒ½å‡ºå£°ã€‚

- éº¦å…‹é£ã€å‰åæ‘„åƒå¤´ã€å…‰çº¿ä¼ æ„Ÿå™¨ã€åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªæ— æ³•è¿ä½œã€‚

  6.12 å†…æ ¸å¯ä»¥ä½¿ç”¨ [Hexagonrpcd](https://github.com/linux-msm/hexagonrpc) ä»¥é©±åŠ¨èµ·ä¸€éƒ¨åˆ†ä¼ æ„Ÿå™¨ï¼Œä½†æˆ‘å¹¶æ²¡æœ‰æŠ˜è…¾è¿™ä¸ªã€‚

### ğŸ”‘ è§£é” bootloader

å¦‚æœä½ æ­£åœ¨è®¤çœŸé˜…è¯»æ­¤æ–‡ï¼Œé‚£ä½ å¤§æ¦‚ç‡åœ¨ç”¨ Linuxã€‚ä½†æ˜¯ï¼Œæ­¤æ­¥éª¤å¿…é¡»åœ¨ Windows ç³»ç»Ÿä¸Šå®Œæˆã€‚

ä½¿ç”¨[å®˜æ–¹è§£é”å·¥å…·](https://www.miui.com/unlock/index.html)è§£é” bootloaderã€‚å¦‚æœç³»ç»Ÿå·²ç»æ›´æ–°åˆ°äº† HyperOSï¼Œè¯·ä½¿ç”¨ [MlgmXyysd çš„è§£é”è„šæœ¬](https://github.com/MlgmXyysd/Xiaomi-HyperOS-BootLoader-Bypass)ç»•è¿‡ç­”é¢˜é™åˆ¶ï¼Œä¹‹åå†ä½¿ç”¨å®˜æ–¹è§£é”å·¥å…·ã€‚

### ğŸ”§ å‡†å¤‡å·¥ä½œ

éœ€è¦åœ¨ç”µè„‘ä¸Šå®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

```bash
sudo pacman -S android-tools base-devel git llvm qemu-user-static qemu-user-static-binfmt
```
ä» xiaomirom.com ä¸‹è½½å°ç±³å¹³æ¿ 5 çš„å®˜æ–¹å¡åˆ·åŒ…ï¼Œå¹¶è§£å‹å‡º `boot.img` å’Œ `vbmeta.img`ã€‚  
å¦‚æœè§‰å¾—å®˜æ–¹ä¸‹è½½å¤ªæ…¢ï¼Œå¯ä»¥è¯•è¯•æŠŠä¸‹è½½åœ°å€ä¸­çš„åŸŸåæ”¹æˆ `bkt-sgp-miui-ota-update-alisgp.oss-ap-southeast-1.aliyuncs.com`ã€‚

åœ¨é•œåƒä¸‹è½½å®Œæˆåï¼Œåœ¨å¹³æ¿ä¸Šå®‰è£… Magisk å¹¶å¯¹ `boot.img` æ‰“è¡¥ä¸ã€‚ä¹‹åï¼ŒæŠŠæ‰“å¥½è¡¥ä¸çš„ `boot.img` ï¼ˆ`magisk_patched-27000_XXXXX.img`ï¼‰æ‹·å›ç”µè„‘ã€‚

è¿˜éœ€è¦å‡†å¤‡ä¸€ä¸ª Uç›˜ï¼Œä¸€ä¸ª Type-C è½¬ USB-A è½¬æ¥å¤´ / æ‹“å±•åå’Œä¸€ä¸ª USB é”®ç›˜æˆ–å®˜æ–¹è§¦ç‚¹é”®ç›˜ã€‚

### ğŸ’½ å¯¹ UFS è¿›è¡Œåˆ†åŒº

{% ablock color:red %}

æ­¤æ­¥éª¤å…·æœ‰å¾ˆé«˜çš„å±é™©æ€§ï¼Œåœ¨æ“ä½œæ—¶è¯·åŠ¡å¿…æ³¨æ„ã€‚  
ä¸€æ—¦å‡ºç°å¤±è¯¯ï¼Œå¯èƒ½å¯¼è‡´å¹³æ¿å˜ç –ï¼Œéœ€è¦ 9008 æ·±åˆ·ä¿®å¤ã€‚

æ­¤æ­¥éª¤å¯èƒ½ä¼šæ¸…é™¤å®‰å“å…¨éƒ¨æ•°æ®ã€‚è¯·æå‰å¤‡ä»½å¹³æ¿æ•°æ®ã€‚

{% endablock %}

ä¸‹è½½[åŒ…å«åˆ†åŒºå·¥å…·çš„ recovery é•œåƒ](https://drive.google.com/file/d/1gCNtoDMNCAmMR61xegvCC3mxv28gMJbi/view?usp=drive_link)ï¼ˆå¦‚æœæ— æ³•è®¿é—®è°·æ­Œï¼Œå¯åœ¨[æœ¬ç«™](https://file.chyk.ink/%E5%AE%89%E5%8D%93%E8%BD%AF%E4%BB%B6/nabu/xiaomi-nabu-orangefox.img)ä¸‹è½½ï¼‰ã€‚ä½¿å¹³æ¿è¿›å…¥ fastboot æ¨¡å¼å¹¶è¿æ¥ç”µè„‘ï¼Œå¼•å¯¼è¿›å…¥ recoveryã€‚

```bash
fastboot boot xiaomi-nabu-orangefox.img
```

å¾…å¹³æ¿å±å¹•å®Œå…¨å˜æˆè“è‰²åï¼Œè¿›å…¥ parted åˆ†åŒºå·¥å…·ã€‚

```bash
adb shell
# æ­¤æ—¶ä¼šè¿›å…¥è¯¥ recovery çš„ shell
parted /dev/block/sda
```

åœ¨ parted ä¸­è¿è¡Œ `print` æŸ¥çœ‹å½“å‰çš„åˆ†åŒºå¸ƒå±€ã€‚  
å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š

```parted parted
(parted) print
print
Model: SAMSUNG KLUDG4UHDC-B0E1 (scsi)
Disk /dev/block/sda: 126GB
Sector size (logical/physical): 4096B/4096B
Partition Table: gpt
Disk Flags:
Number  Start   End     Size    File system  Name             Flags
 1      24.6kB  32.8kB  8192B                switch
 2      32.8kB  65.5kB  32.8kB               ssd
 3      65.5kB  98.3kB  32.8kB               dbg
 4      98.3kB  131kB   32.8kB               bk01
 5      131kB   262kB   131kB                bk02
 6      262kB   524kB   262kB                bk03
 7      524kB   1049kB  524kB                bk04
 8      1049kB  1573kB  524kB                keystore
 9      1573kB  2097kB  524kB                frp
10      2097kB  4194kB  2097kB               countrycode
11      4194kB  8389kB  4194kB               misc
12      8389kB  12.6MB  4194kB               vm-data
13      12.6MB  16.8MB  4194kB               bk06
14      16.8MB  25.2MB  8389kB               logfs
15      25.2MB  33.6MB  8389kB               ffu
16      33.6MB  50.3MB  16.8MB               oops
17      50.3MB  67.1MB  16.8MB               devinfo
18      67.1MB  83.9MB  16.8MB               oem_misc1
19      83.9MB  101MB   16.8MB  ext4         metadata
20      101MB   134MB   32.9MB               bk08
21      134MB   168MB   34.2MB               splash
22      168MB   201MB   33.6MB               bk09
23      201MB   9328MB  9127MB               super
24      9328MB  9328MB  131kB                vbmeta_system_a
25      9328MB  9328MB  131kB                vbmeta_system_b
26      9328MB  9396MB  67.1MB               logdump
27      9396MB  9530MB  134MB                minidump
28      9530MB  9664MB  134MB                rawdump
29      9664MB  10.7GB  1074MB  ext4         cust
30      10.7GB  10.9GB  134MB   ext4         rescue
31      10.9GB  126GB   115GB                userdata
```

å…¶ä¸­åˆ†åŒº 31 å°±æ˜¯å®‰å“çš„ userdata åˆ†åŒºã€‚æˆ‘ä»¬éœ€è¦ç¼©å° userdata åˆ†åŒºï¼Œç»™ Linux æä¾›ç©ºé—´ã€‚

è¾“å…¥ `rm 31` æš‚æ—¶åˆ é™¤ userdata åˆ†åŒºã€‚

```parted parted
(parted) rm 31
rm 31
```

å†è¿è¡Œ `print` æ—¶ï¼Œuserdata åˆ†åŒºåº”è¯¥ä¼šæ¶ˆå¤±ã€‚

```parted parted
(parted) print
print
Model: SAMSUNG KLUDG4UHDC-B0E1 (scsi)
Disk /dev/block/sda: 126GB
Sector size (logical/physical): 4096B/4096B
Partition Table: gpt
Disk Flags:
Number  Start   End     Size    File system  Name             Flags
 1      24.6kB  32.8kB  8192B                switch
 2      32.8kB  65.5kB  32.8kB               ssd
 3      65.5kB  98.3kB  32.8kB               dbg
 4      98.3kB  131kB   32.8kB               bk01
 5      131kB   262kB   131kB                bk02
 6      262kB   524kB   262kB                bk03
 7      524kB   1049kB  524kB                bk04
 8      1049kB  1573kB  524kB                keystore
 9      1573kB  2097kB  524kB                frp
10      2097kB  4194kB  2097kB               countrycode
11      4194kB  8389kB  4194kB               misc
12      8389kB  12.6MB  4194kB               vm-data
13      12.6MB  16.8MB  4194kB               bk06
14      16.8MB  25.2MB  8389kB               logfs
15      25.2MB  33.6MB  8389kB               ffu
16      33.6MB  50.3MB  16.8MB               oops
17      50.3MB  67.1MB  16.8MB               devinfo
18      67.1MB  83.9MB  16.8MB               oem_misc1
19      83.9MB  101MB   16.8MB  ext4         metadata
20      101MB   134MB   32.9MB               bk08
21      134MB   168MB   34.2MB               splash
22      168MB   201MB   33.6MB               bk09
23      201MB   9328MB  9127MB               super
24      9328MB  9328MB  131kB                vbmeta_system_a
25      9328MB  9328MB  131kB                vbmeta_system_b
26      9328MB  9396MB  67.1MB               logdump
27      9396MB  9530MB  134MB                minidump
28      9530MB  9664MB  134MB                rawdump
29      9664MB  10.7GB  1074MB  ext4         cust
30      10.7GB  10.9GB  134MB   ext4         rescue
```

ä¹‹åé‡æ–°åˆ›å»º userdata åˆ†åŒºã€‚

`mkpart userdata   10.9GB 50GB`

å…¶ä¸­ï¼Œ`10.9GB` ä¸ºä¸Šä¸€åˆ†åŒºçš„ç»“å°¾ï¼ˆå‚è§ `print` çš„è¾“å‡ºï¼‰ï¼Œ`50GB` ä¸ºå®‰å“ userdata åˆ†åŒºçš„æ–°å¤§å°ã€‚

{%ablock color:red âš ï¸&nbsp;æ³¨æ„ %}

`userdata` å’Œ `10.9GB` ä¸­é—´æœ‰ä¸‰ä¸ªç©ºæ ¼ã€‚è¿™æ ·æ‰å¯ä»¥ç¡®ä¿ userdata åˆ†åŒºä¸è¢«é‡æ–°æ ¼å¼åŒ–ã€‚ 

å¦‚æœä½ ä¸å°å¿ƒåœ¨ `userdata` å’Œ `10.9GB` ä¹‹é—´æ·»åŠ äº† ext4ï¼Œé‚£ä¹ˆ userdata åˆ†åŒºä¼šè¢«æ ¼å¼åŒ–ã€‚è¿™å°±ç›¸å½“äºåœ¨ recovery ä¸­é€‰æ‹©ã€Œæ¸…é™¤æ•°æ®ã€äº†ã€‚

{% endablock %}

```parted parted
(parted) mkpart userdata   10.9GB 50GB
mkpart userdata   10.9GB 50GB    #If you added "ext4" behind the "userdata" text, your data will be erased when you reboot. 
```

ä¹‹åå°±å¯ä»¥åˆ›å»º Linux åˆ†åŒºäº†ã€‚

è¾“å…¥ `print free` å¯ä»¥æŸ¥çœ‹ç£ç›˜çš„å‰©ä½™ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºç»™ Linux ä½¿ç”¨ã€‚

`mkpart archlinux ext4 50.0GB 126GB`

å…¶ä¸­ï¼Œ`50.0GB` ä¸º Linux åˆ†åŒºçš„èµ·ç‚¹ï¼Œ`126GB` ä¸º Linux åˆ†åŒºçš„**ç»ˆç‚¹**ï¼ˆä¸æ˜¯å¤§å°ï¼‰ã€‚

```parted parted
(parted) mkpart archlinux ext4 50.0GB 126GB
mkpart archlinux ext4 50.0GB 126GB

(parted) print free
print free
Model: SAMSUNG KLUDG4UHDC-B0E1 (scsi)
Disk /dev/block/sda: 126GB
Sector size (logical/physical): 4096B/4096B
Partition Table: gpt
Disk Flags:
Number  Start   End     Size    File system  Name             Flags
        12.3kB  24.6kB  12.3kB  Free Space
 1      24.6kB  32.8kB  8192B                switch
 2      32.8kB  65.5kB  32.8kB               ssd
 3      65.5kB  98.3kB  32.8kB               dbg
 4      98.3kB  131kB   32.8kB               bk01
 5      131kB   262kB   131kB                bk02
 6      262kB   524kB   262kB                bk03
 7      524kB   1049kB  524kB                bk04
 8      1049kB  1573kB  524kB                keystore
 9      1573kB  2097kB  524kB                frp
10      2097kB  4194kB  2097kB               countrycode
11      4194kB  8389kB  4194kB               misc
12      8389kB  12.6MB  4194kB               vm-data
13      12.6MB  16.8MB  4194kB               bk06
14      16.8MB  25.2MB  8389kB               logfs
15      25.2MB  33.6MB  8389kB               ffu
16      33.6MB  50.3MB  16.8MB               oops
17      50.3MB  67.1MB  16.8MB               devinfo
18      67.1MB  83.9MB  16.8MB               oem_misc1
19      83.9MB  101MB   16.8MB  ext4         metadata
20      101MB   134MB   32.9MB               bk08
21      134MB   168MB   34.2MB               splash
22      168MB   201MB   33.6MB               bk09
23      201MB   9328MB  9127MB               super
24      9328MB  9328MB  131kB                vbmeta_system_a
25      9328MB  9328MB  131kB                vbmeta_system_b
26      9328MB  9396MB  67.1MB               logdump
27      9396MB  9530MB  134MB                minidump
28      9530MB  9664MB  134MB                rawdump
29      9664MB  10.7GB  1074MB  ext4         cust
30      10.7GB  10.9GB  134MB   ext4         rescue
        10.9GB  10.9GB  786kB   Free Space
31      10.9GB  50.0GB  39.1GB               userdata
32      50.0GB  126.0GB  76.0GB  ext4        archlinux
```

ä¹‹åï¼Œè¾“å…¥ `quit` é€€å‡º parted å·¥å…·ï¼Œè¾“å…¥ `poweroff` å‘½ä»¤å…³æœºã€‚  
æ­¤æ—¶å¯ä»¥æŠŠå¹³æ¿è°ƒå›åˆ° fastboot æ¨¡å¼å¤‡ç”¨ã€‚

### ğŸ§ ç¼–è¯‘å†…æ ¸

å›åˆ°ç”µè„‘ä¸Šæ“ä½œã€‚

å¯ä»¥å…‹éš† postmarketOS å¼€å‘è€…ç»´æŠ¤çš„ 6.12-rc7 å†…æ ¸æ ‘ï¼Œå¹¶æ‰“ä¸Š[å……ç”µå™¨å’Œ RTC çš„ä¿®å¤è¡¥ä¸](https://file.chyk.ink/Linux/nabu-patches)ã€‚

```bash
git clone https://gitlab.postmarketos.org/panpanpanpan/sm8150-mainline --branch=6.12-wip
```

ä¹Ÿå¯ä»¥å…‹éš†æˆ‘è‡ªå·±åˆ†å‰å‡ºæ¥çš„ 6.12.0 å†…æ ¸æ ‘ï¼Œå·²ç»æ‰“å¥½äº†è¿™ä¸¤ä¸ªè¡¥ä¸ã€‚

```bash
git clone https://github.com/chiyuki0325/sm8150-mainline --branch=6.12-wip
```

```bash
pushd sm8150-mainline

# è®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ã€‚
export ARCH=arm64 LLVM=1 LLVM_IAS=1

# æ­¤æ—¶å¯ä»¥ä½¿ç”¨ git apply å‘½ä»¤æ‰“ä¸Šéœ€è¦çš„è¡¥ä¸ã€‚

# åŠ è½½ defconfig é…ç½®æ–‡ä»¶
make defconfig sm8150.config

# è°ƒæ•´å†…æ ¸é…ç½®ã€‚
make nconfig
# è¿›å…¥ nconfig é…ç½®ç•Œé¢åï¼Œæ ¹æ®å®é™…çš„ä½¿ç”¨éœ€æ±‚è°ƒæ•´é…ç½®ã€‚ä¹‹åæŒ‰ F9 ä¿å­˜é…ç½®å¹¶é€€å‡ºã€‚
# è¿™é‡Œç»™å‡ºå‡ ä¸ªå¯èƒ½æœ‰ç”¨çš„è®¾ç½®ï¼š

# è¦åœ¨ Clashã€NekoBox ç­‰ä»£ç†å·¥å…·ä¸­ä½¿ç”¨é€æ˜ä»£ç†éœ€è¦æ‰“å¼€ä»¥ä¸‹é€‰é¡¹ï¼š
# Networking support -> Networking options -> æ‰“å¼€ IP: tunneling
# File systems -> æ‰“å¼€ Ext4 Security Labels
# Cryptographic API ä¸­æ ¹æ®ä½¿ç”¨çš„åè®®é…Œæƒ…å¼€å¯

# å¦‚æœæœ‰æ’ U ç›˜çš„éœ€æ±‚å»ºè®®å¼€å¯ä»¥ä¸‹é€‰é¡¹ï¼š
# File systems -> DOS/FAT/EXFAT/NT Filesystems
# æ‰“å¼€ exFAT filesystem support å’Œ NTFS Read-Write file system support

# å¦‚æœå¯¹é”®ç›˜çš„æŒ‰é”®å¸ƒå±€ä¸æ»¡æ„ï¼Œéœ€è¦ä½¿ç”¨ xremap ç­‰æŒ‰é”®æ˜ å°„å·¥å…·
# éœ€è¦æ‰“å¼€æ­¤é€‰é¡¹ï¼š
# Device Drivers -> Input device support -> Miscellaneous devices
# æ‰“å¼€ User level driver support

# ç¼–è¯‘å†…æ ¸ã€‚å»ºè®®å…³é—­ç”µè„‘ä¸Šè¿è¡Œçš„å…¶å®ƒç¨‹åºã€‚
make Image Image.gz dtbs modules -j $(nproc)

# å¯¼å‡ºæ¨¡å—æ–‡ä»¶ã€‚
make modules_install INSTALL_MOD_PATH=./modules_install

popd
```

```bash
cat sm8150-mainline/arch/arm64/boot/Image.gz sm8150-mainline/arch/arm64/boot/dts/qcom/sm8150-xiaomi-nabu.dtb > zImage
mkbootimg --kernel zImage --cmdline "pd_ignore_unused clk_ignore_unused console=tty0 root=/dev/sda32 rw rootwait" --base 0x00000000 --kernel_offset 0x00008000 --tags_offset 0x00000100 --pagesize 4096 --id -o linux.boot.img
```

æ­¤å¤„çš„ sda32 å³ä¸ºä¸Šä¸€æ­¥åˆ›å»ºçš„ï¼Œç»™ Linux ä½¿ç”¨çš„ç¬¬ 32 å·åˆ†åŒºã€‚

### ğŸ“‚ åˆ¶ä½œ rootfs

é¦–å…ˆä¸‹è½½ä¸€ä¸ªå…¨æ–°çš„ Arch Linux ARM rootfsï¼Œå¹¶ä½¿ç”¨ root æƒé™è§£å‹ã€‚

```bash
wget https://mirrors.tuna.tsinghua.edu.cn/archlinuxarm/os/ArchLinuxARM-aarch64-latest.tar.gz
sudo tar -xf ArchLinuxARM-aarch64-latest.tar.gz -C rootfs
```

æŠŠåˆšç¼–è¯‘å¥½çš„æ¨¡å—æ–‡ä»¶å¤¹ç§»åˆ° rootfs ä¸­ã€‚

```bash
sudo rm -rf rootfs/usr/lib/modules
sudo mv sm8150-mainline/modules_install/lib/modules rootfs/usr/lib/
```

ä¹‹åå®‰è£…å›ºä»¶ã€‚

åœ¨ https://github.com/map220v/ubuntu-xiaomi-nabu/actions ä¸­ä¸‹è½½æœ€æ–°çš„ xiaomi-nabu-debs_6.7-working æ–‡ä»¶ï¼Œä¹‹åè‡ªè¡Œè§£å‹ firmware-xiaomi-nabu.deb å’Œ alsa-xiaomi-nabu.deb å¹¶å®‰è£…åˆ° rootfs å³å¯ã€‚

æŒ‚è½½ rootfs å¹¶ä½¿ç”¨ chroot è¿›å…¥å…¶ä¸­ã€‚

```bash
sudo mount --bind rootfs rootfs
sudo cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/qemu-aarch64-static
sudo arch-chroot rootfs
```

ä¹‹åç®€å•é…ç½®ç³»ç»Ÿã€‚  
ä»¥ä¸‹æ­¥éª¤å‚è€ƒäº† Arch Wikiã€‚

```bash åœ¨ rootfs ä¸­
nano /etc/pacman.conf
# å‚ç…§ https://mirrors.tuna.tsinghua.edu.cn/help/archlinuxcn/ çš„è¯´æ˜
# åŠ å…¥ archlinuxcn é•œåƒä»“åº“
nano /etc/pacman.d/mirrorlist
# é…ç½®é•œåƒæº

pacman-key --init
pacman-key --populate
pacman-key --lsign-key "farseerfc@archlinux.org"
pacman -Syu archlinux-keyring archlinuxarm-keyring archlinuxcn-keyring
pacman -S base-devel wpa_supplicant networkmanager bluez bluez-utils
pacman -S vim git sudo openssh bash-completion iproute2
pacman -S yay  # ä¹Ÿå¯ä½¿ç”¨ paru ç­‰ AUR helper
pacman -Rdd linux
systemctl enable NetworkManager
systemctl enable bluetooth

echo "mipad5" >> /etc/hostname  # æ­¤å¤„è¯·æ›´æ”¹ä¸ºè‡ªå·±çš„ä¸»æœºå
echo "127.0.0.1 localhost" >> /etc/hosts
echo "127.0.0.1 mipad5" >> /etc/hosts
echo "::1 localhost" >> /etc/hosts
echo "PARTLABEL=archlinux / ext4 errors=remount-ro,x-systemd.growfs,discard,relatime 0 1" > /etc/fstab

# éƒ¨åˆ†å¿…é¡»çš„åŸºæœ¬è½¯ä»¶åŒ…åœ¨ AUR ä¸Šï¼Œæ‰€ä»¥å¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·
useradd -m -G wheel -s /bin/bash youruser  # æ­¤å¤„è¯·æ›´æ”¹ä¸ºè‡ªå·±çš„ç”¨æˆ·å
passwd youruser
EDITOR=vim visudo  # å–æ¶ˆæ³¨é‡Š %wheel ALL=(ALL:ALL) ALL è¡Œ

su youruser
yay -S qrtr-git libqrtr-glib rmtfs-git tqftpserv-git
exit

systemctl enable qrtr-ns rmtfs tqftpserv
```

```bash
exit
sudo umount -R rootfs
sudo rm rootfs/usr/bin/qemu-aarch64-static
sudo chown -R 0:0 rootfs
sudo chown -R 1000:1000 rootfs/home/youruser
```

æŠŠ rootfs æ‰“åŒ…æˆ img é•œåƒã€‚

```bash
dd if=/dev/zero of=./rootfs.img bs=1M count=3072
mkfs -t ext4 ./rootfs.img
mkdir mnt
sudo mount -o loop rootfs.img ./mnt
sudo cp ./rootfs/* ./mnt -avrf
sudo umount ./mnt
rmdir ./mnt
e2fsck -p -f rootfs.img
resize2fs -M rootfs.img
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸‰ä¸ªé•œåƒï¼š`magisk_patched-27000_XXXXX.img`ã€`linux.boot.img` å’Œ `rootfs.img`ã€‚

### ğŸ“²  åˆ·å†™é•œåƒ

åœ¨å¹³æ¿ä¸Šå®‰è£… [linuxswitch](https://github.com/timoxa0/Switch2Linux-Nabu/releases/download/v1.0.2/linuxswitch.apk)ï¼Œå¹¶åœ¨è¯¥è½¯ä»¶ä¸­ç‚¹å‡» "Dump android images"ã€‚  
ä¹‹åæŠŠ `linux.boot.img` æ”¾å…¥å¹³æ¿å†…éƒ¨å­˜å‚¨ä¸­çš„ `linux` æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”ä»è¯¥æ–‡ä»¶å¤¹ä¸­å–å‡º `android.boot.img` å’Œ `android.dtbo.img`ã€‚

ç„¶åï¼Œåˆ‡åˆ° fastboot æ¨¡å¼ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ·å…¥ Arch Linux ç³»ç»Ÿï¼š

```bash
fastboot flash vbmeta_ab --disable-verification --disable-verity vbmeta.img
fastboot erase dtbo_ab
fastboot flash boot_ab linux.boot.img
fastboot flash archlinux rootfs.img
```

é‡å¯å¹³æ¿å³å¯è¿›å…¥ Linux ç³»ç»Ÿï¼Œä¹‹åç™»å½•ï¼Œæ’å…¥é”®ç›˜ï¼Œå³å¯ä½¿ç”¨ `nmtui` è¿æ¥ç½‘ç»œï¼Œå®‰è£…æ¡Œé¢ç¯å¢ƒç­‰ã€‚

```bash
nmtui
ping baidu.com
rm /etc/locale.gen
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
echo "zh_CN.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen
echo "LANG=zh_CN.UTF-8" > /etc/locale.conf
pacman -S noto-fonts noto-fonts-cjk gnome gdm firefox
# å®‰è£…æ—¶å¯ä»¥æ‰‹åŠ¨æ’é™¤ gnome-boxes ä»¥èŠ‚çœç©ºé—´
systemctl enable --now gdm
```

åœ¨ Linux ä¾§ä¸‹è½½ [s2a](https://github.com/timoxa0/Switch2Linux-Nabu/releases/download/v1.0.1/s2a.zip) å·¥å…·ï¼Œè§£å‹ï¼Œå¹¶ç”¨ U ç›˜æŠŠä¹‹å‰çš„ `android.boot.img` å’Œ `android.dtbo.img` æ‹·åˆ°å¹³æ¿ä¸­ï¼Œæ”¾åˆ° s2a æ–‡ä»¶å¤¹é‡Œã€‚

è¿è¡Œ `sudo bash ./install.sh` å®‰è£… s2aï¼Œæ³¨é”€å¹¶é‡æ–°ç™»å½•ï¼Œå³å¯åœ¨å…¨éƒ¨åº”ç”¨ä¸­æ‰¾åˆ° Switch2Android æ¡ç›®ã€‚

åœ¨å®‰å“ä¾§å¯ä»¥ä» Switch to Linux è¿™ä¸ª app åˆ‡æ¢åˆ° Linuxã€‚

è‡³æ­¤ï¼Œå®‰å“ + Arch Linux åŒç³»ç»Ÿå·²ç»å®‰è£…å®Œæˆã€‚

### ğŸšï¸ æ¡Œé¢è°ƒä¼˜

ç”±äºéªé¾™ 860 çš„æ€§èƒ½ä¸è¶³ä»¥å¸¦åŠ¨ä¼˜åŒ–å¾ˆå·®çš„åŸç‰ˆ GNOMEï¼Œå› æ­¤éœ€è¦åšä¸€äº›ä¼˜åŒ–ã€‚

```bash
yay -S mutter-performance
echo "GSK_RENDERER=gl" | sudo tee /etc/profile.d/environment.sh
```

ä¹‹ååŠ¨ç”»å°±ä¸ä¼šå†å¡é¡¿äº†ã€‚

è™šæ‹Ÿé”®ç›˜å¯ä»¥ä½¿ç”¨ GNOME è‡ªå¸¦çš„ maliit æˆ– OpenKylin çš„ kylin-virtual-keyboardã€‚æ‰©å±•å¯ä»¥å®‰è£… Disable Gestures 2021 æ¥åœ¨å…¨å±æ¸¸æˆä¸­ç¦ç”¨æ‰‹åŠ¿ã€‚

### ğŸ–¼ï¸ æ•ˆæœå›¾

{%image https://imgsrc.chyk.ink/e7cd7b899e510fb3a072b3a99f33c895d1430ca1.webp %}

> æ­¤æˆªå›¾å·²ç»è¿‡æ—¶ï¼Œä½†å¯ä»¥å¤§æ¦‚ä½œä¸ºå‚è€ƒã€‚
