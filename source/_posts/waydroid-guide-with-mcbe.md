---
categories: []
category: ArchæŠ˜è…¾è®°
date: '2022-06-26 13:34:14'
tags:
- Waydroid
- å®‰å“
title: ğŸ¤– ä½¿ç”¨ Waydroid å®‰å“å­ç³»ç»Ÿæ„‰å¿«æ¸¸ç©æˆ‘çš„ä¸–ç•ŒåŸºå²©ç‰ˆ
updated: '2022-08-05 15:25:52'
---
Waydroid æ˜¯ä¸€æ¬¾æ–°å…´çš„å®‰å“å­ç³»ç»Ÿè½¯ä»¶ï¼Œå’Œå…ˆå‰çš„ Anbox ä¸€æ ·ä½¿ç”¨ LXC è¿è¡Œå®‰å“å®¹å™¨ï¼Œä½† Waydroid å¯¹äº GPU çš„æ”¯æŒæ›´å¥½ï¼Œå¹¶ä¸”æ”¯æŒé¼ æ ‡ç›´é€šç­‰ï¼Œè¾“å…¥å’ŒéŸ³é¢‘å»¶è¿Ÿä¹Ÿå‡ ä¹æ²¡æœ‰ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥æ‰“æ¸¸æˆï¼

åœ¨æ¸²æŸ“é¾™åˆ°æ¥ä¹‹é™…ï¼ŒMCPELauncher é¡¹ç›®åœæ­¢æ›´æ–°ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ Waydroid æ¥æ¸¸ç©ã€Šæˆ‘çš„ä¸–ç•Œã€‹åŸºå²©ç‰ˆã€‚

<!--more-->

## âš ï¸ ç”¨å‰é¡»çŸ¥

> - Waydroid åªæ”¯æŒ Wayland å›¾å½¢ç¯å¢ƒï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨åŸºäº X11 çš„æ¡Œé¢ï¼Œè¯·åˆ‡æ¢åˆ° Wayland ä¼šè¯æˆ–è€…ä½¿ç”¨ [Weston](https://wiki.archlinux.org/title/Weston) ã€‚
> - Waydroid ç›®å‰ä¸æ”¯æŒè‹±ä¼Ÿè¾¾æ˜¾å¡å’Œéƒ¨åˆ† AMD æ˜¾å¡ï¼ˆæ¯”å¦‚ RX 6800ï¼‰ï¼Œæ‰€ä»¥éœ€è¦æ€§èƒ½å¼ºå¤§çš„æ ¸æ˜¾ï¼Œæˆ–è€…[ä½¿ç”¨è½¯ä»¶æ¸²æŸ“](#ğŸ–¥-åˆ‡æ¢åˆ°è½¯ä»¶æ¸²æŸ“)ã€‚
> - Waydroid åœ¨ 5.18 ä»¥ä¸‹å†…æ ¸éœ€è¦ `ashmem` å’Œ `binder` å†…æ ¸æ¨¡å—ï¼Œå®˜æ–¹è½¯ä»¶ä»“åº“ä¸­çš„ `linux-zen` å’Œä¸€äº›ç¬¬ä¸‰æ–¹å†…æ ¸ï¼ˆå¦‚ `linux-lily`ï¼‰å¸¦äº†è¿™ä¸¤ä¸ªæ¨¡å—ã€‚å¦‚æœä½ ä½¿ç”¨çš„å†…æ ¸ä¸å¸¦è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆå®‰è£… `anbox-modules-dkms-git` è½¯ä»¶åŒ…ã€‚
> - Waydroid åœ¨ 5.18 ä»¥ä¸Šå†…æ ¸ä»…éœ€è¦ `binder` å†…æ ¸æ¨¡å—ã€‚
> - Waydroid ç›®å‰ä¸æ”¯æŒæ¸¸æˆä¸­é¼ æ ‡æ•è·ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æ‰‹æŸ„æ¸¸ç©ï¼Œæˆ–è€…ä½¿ç”¨å…¨é”®ç›˜ç©æ³•ï¼ˆ~~æ­£å¸¸äººéƒ½ä¸ä¼šç”¨å…¨é”®ç›˜å§~~ï¼‰ã€‚
> - Waydroid ä¸æ”¯æŒè¾“å…¥ä¸­æ–‡ã€‚

## ğŸª¤ å¼€å§‹å®‰è£…

é¦–å…ˆä» AUR å®‰è£… Waydroid æœ¬ä½“ã€‚

```bash
yay -S waydroid
```

ä¹‹åå®‰è£… Waydroid é•œåƒã€‚

```bash
yay -S waydroid-image
```

## ğŸ”„ åˆå§‹åŒ–

å°†å¦‚ä¸‹å†…å®¹å†™å…¥åˆ° `/etc/fstab` ä»¥å®ç°å¼€æœºè‡ªåŠ¨åŠ è½½ binderfsï¼š

```
binder /dev/binderfs binder defaults,nofail 0 
```

å¦‚æœæ˜¯ 5.18+ å†…æ ¸ï¼Œå‚è€ƒ[è¿™æ¡ issue](https://github.com/waydroid/waydroid/issues/406) æ›´æ”¹é…ç½®æ–‡ä»¶å¯ç”¨ `memfd`ã€‚

åœ¨ä½¿ç”¨ 5.18+ å†…æ ¸å’Œ `memfd` æ—¶ï¼Œæ— æ³•ç™»å½•è°·æ­Œå•†åº—ï¼Œæ‰€ä»¥ç™»å½•æ—¶è¿˜è¯·ä½¿ç”¨è€å†…æ ¸ã€‚

å¦‚æœæ˜¯æ‰‹åŠ¨å®‰è£…çš„å†…æ ¸æ¨¡å—ï¼Œé‚£ä¹ˆå°†ä»¥ä¸‹å†…å®¹å†™å…¥ `/etc/modules-load.d/anbox.conf  ` ï¼›

```
ashmem_linux
binder_linux
```

å¦‚æœæ˜¯ `linux-xanmod` å†…æ ¸ï¼Œé‚£ä¹ˆå°† `psi=1` å†™åˆ° `/etc/default/grub` çš„ `GRUB_CMDLINE_LINUX_DEFAULT` è¡Œæœ«å°¾ï¼Œä¹‹åé‡æ–°ç”Ÿæˆ GRUB é…ç½®æ–‡ä»¶ï¼ˆ`sudo grub-mkconfig -o /boot/grub/grub.cfg ` æˆ–ä½ è‡ªå·±çš„ GRUB é…ç½®æ–‡ä»¶ä½ç½®ï¼‰ã€‚

ä¹‹åæ‰§è¡Œè¿™äº›å‘½ä»¤ä»¥åˆå§‹åŒ–ï¼›

```bash
sudo sysctl kernel.unprivileged_bpf_disabled=0 # æˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œä½†ä¼°è®¡æ˜¯å†…æ ¸æƒé™ç›¸å…³çš„ä¸œè¥¿
echo 'kernel.unprivileged_bpf_disabled = 0' | sudo tee /etc/sysctl.d/99-sysctl.conf # ä½¿ä¸Šä¸€å¥æ°¸ä¹…ç”Ÿæ•ˆ
sudo systemctl enable --now waydroid-container.service # å¼€æœºè‡ªå¯åŠ¨ Waydroid åå°æœåŠ¡ï¼ˆä¸è¿å®¹å™¨ä¸€èµ·è‡ªå¯ï¼‰
sudo waydroid init -f # åˆå§‹åŒ–é•œåƒ
```

å¦‚æœä½ æ˜¯å¸¦åŒæ˜¾å¡çš„ç”µè„‘ï¼ˆæ¯”å¦‚æ¸¸æˆæœ¬ï¼‰ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå¹¶é€‰æ‹©ä½ çš„æ ¸æ˜¾ã€‚

```
https://github.com/Quackdoc/waydroid-scripts/raw/main/waydroid-choose-gpu.sh
```

## ğŸ¤– è¿›å…¥å®‰å“

```bash
waydroid session start 
waydroid show-full-ui
```

æˆ–ä»åº”ç”¨åˆ—è¡¨é‡Œç›´æ¥å¯åŠ¨ Waydroidã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦è§£å‹é•œåƒï¼Œæ—¶é—´å¾ˆé•¿ï¼Œä¸è¿‡ä¹‹åå°±å¿«äº†ã€‚

åœ¨å¯åŠ¨ä¹‹åï¼Œç³»ç»Ÿç•Œé¢å°†è¢«å…¨å±çš„å®‰å“ç³»ç»Ÿç•Œé¢è¦†ç›–ï¼ˆå¯ç”¨ Alt+Tab ç­‰é”®ç»„åˆåˆ‡å› Linux æ¡Œé¢ï¼‰ã€‚

åœ¨è¿›å…¥å®‰å“ä¹‹åé¦–å…ˆå°†è¯­è¨€æ”¹ä¸ºä¸­æ–‡ï¼ˆå¯é€‰ï¼‰ï¼Œä¹‹ååœ¨ {% kbd åº”ç”¨å’Œé€šçŸ¥ %} - {% kbd åº”ç”¨ä¿¡æ¯ %} ä¸­åœç”¨ `Android è®¾ç½®å‘å¯¼` ï¼ˆéœ€è¦å¼€å¯æ˜¾ç¤ºç³»ç»Ÿåº”ç”¨ï¼‰ï¼Œå¦åˆ™ä¼šåå¤å¼¹å‡º Android è®¾ç½®å‘å¯¼å±¡æ¬¡åœæ­¢è¿è¡Œçš„å¼¹æ¡†ã€‚

{% image https://imgsrc.chyk.ink/cefc1e178a82b9019a5718ea368da9773812ef76.webp %}

ç”±äºé•œåƒè‡ªå¸¦è°·æ­ŒæœåŠ¡ï¼Œæ‰€ä»¥ä¹‹åå¯ä»¥è¿›å…¥è°·æ­Œå•†åº—ä¸‹è½½æ¸¸æˆã€‚

{% image https://imgsrc.chyk.ink/1ad5ad6eddc451da2427d732f3fd5266d1163212.webp %}

åœ¨å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹æ¸¸ç©äº†ã€‚

{% image https://imgsrc.chyk.ink/adaf2edda3cc7cd9c819ee007c01213fb80e9137.webp æœ€ç»ˆï¼Œå¼€æºç¤¾åŒºå‡»è´¥äº†æ¸²æŸ“é¾™ï¼ %}

## ğŸ’  å…¶å®ƒè¯´æ˜

#### ğŸ–¥ åˆ‡æ¢åˆ°è½¯ä»¶æ¸²æŸ“

å¦‚æœä½ ä½¿ç”¨ä¸æ”¯æŒçš„æ˜¾å¡ï¼Œè¯·æŠŠè¿™ä¸¤è¡Œå†™å…¥ `/var/lib/waydroid/waydroid_base.prop` æ¥å¯ç”¨è½¯ä»¶æ¸²æŸ“ï¼š

```ini
ro.hardware.gralloc=default
ro.hardware.egl=swiftshader
```
